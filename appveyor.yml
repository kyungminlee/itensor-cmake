version: 1.0.{build}
image:
    - Visual Studio 2019
platform:
    - x64
configuration:
    - Debug
    - Release
before_build:
    - cmd: git submodule init
    - cmd: git submodule update
    - cmd: cmake -H. -B build -DCMAKE_INSTALL_PREFIX=%APPVEYOR_BUILD_FOLDER%\installdir
build:
    verbosity: detailed
    parallel: true
build_script:
    - cmd: cmake --build build --target INSTALL --config %CONFIGURATION% #-- /nologo /verbosity:minimal /maxcpucount
after_build:
    - cd %APPVEYOR_BUILD_FOLDER%
    - set BUILD_ARCHIVE=%APPVEYOR_PROJECT_NAME%-%CONFIGURATION%.zip
    - cmd: 7z a %BUILD_ARCHIVE% installdir
    - appveyor PushArtifact %BUILD_ARCHIVE%
artifacts:
    - path: '*.zip'
